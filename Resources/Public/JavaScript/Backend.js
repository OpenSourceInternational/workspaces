/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}();define(["require","exports","TYPO3/CMS/Backend/Enum/Severity","jquery","TYPO3/CMS/Backend/Modal","TYPO3/CMS/Backend/Storage/Persistent","TYPO3/CMS/Backend/Tooltip","TYPO3/CMS/Backend/Utility","TYPO3/CMS/Backend/Viewport","TYPO3/CMS/Backend/Wizard","./Workspaces","twbs/bootstrap-slider","nprogress","TYPO3/CMS/Backend/jquery.clearable"],function(require,exports,Severity_1,$,Modal,Persistent,Tooltip,Utility,Viewport,Wizard,Workspaces_1){"use strict";var Identifiers;!function(e){e.searchForm="#workspace-settings-form",e.searchTextField='#workspace-settings-form input[name="search-text"]',e.searchSubmitBtn='#workspace-settings-form button[type="submit"]',e.depthSelector='#workspace-settings-form [name="depth"]',e.languageSelector='#workspace-settings-form select[name="languages"]',e.chooseStageAction='#workspace-actions-form [name="stage-action"]',e.chooseSelectionAction='#workspace-actions-form [name="selection-action"]',e.chooseMassAction='#workspace-actions-form [name="mass-action"]',e.container="#workspace-panel",e.actionIcons="#workspace-action-icons",e.toggleAll=".t3js-toggle-all",e.previewLinksButton=".t3js-preview-link",e.pagination="#workspace-pagination"}(Identifiers||(Identifiers={}));var Backend=function(_super){function Backend(){var _this=_super.call(this)||this;return _this.elements={},_this.settings={dir:"ASC",id:TYPO3.settings.Workspaces.id,language:TYPO3.settings.Workspaces.language,limit:30,query:"",sort:"label_Live",start:0,filterTxt:""},_this.paging={currentPage:1,totalPages:1,totalItems:0},_this.allToggled=!1,_this.latestPath="",_this.markedRecordsForMassAction=[],_this.indentationPadding=26,_this.handleCheckboxChange=function(e){var t=$(e.currentTarget),a=t.parents("tr"),n=a.data("table")+":"+a.data("uid")+":"+a.data("t3ver_oid");if(t.prop("checked"))_this.markedRecordsForMassAction.push(n),a.addClass("warning");else{var i=_this.markedRecordsForMassAction.indexOf(n);i>-1&&_this.markedRecordsForMassAction.splice(i,1),a.removeClass("warning")}_this.elements.$chooseStageAction.prop("disabled",0===_this.markedRecordsForMassAction.length),_this.elements.$chooseSelectionAction.prop("disabled",0===_this.markedRecordsForMassAction.length),_this.elements.$chooseMassAction.prop("disabled",_this.markedRecordsForMassAction.length>0)},_this.viewChanges=function(e){e.preventDefault();var t=$(e.currentTarget).closest("tr");_this.sendRemoteRequest(_this.generateRemotePayload("getRowDetails",{stage:t.data("stage"),t3ver_oid:t.data("t3ver_oid"),table:t.data("table"),uid:t.data("uid")})).done(function(e){var a=e[0].result.data[0],n=$("<div />"),i=$("<ul />",{class:"nav nav-tabs",role:"tablist"}),s=$("<div />",{class:"tab-content"}),o=[];n.append($("<p />").html(TYPO3.lang.path.replace("{0}",a.path_Live)),$("<p />").html(TYPO3.lang.current_step.replace("{0}",a.label_Stage).replace("{1}",a.stage_position).replace("{2}",a.stage_count))),a.diff.length>0&&(i.append($("<li />",{role:"presentation"}).append($("<a />",{href:"#workspace-changes","aria-controls":"workspace-changes",role:"tab","data-toggle":"tab"}).text(TYPO3.lang["window.recordChanges.tabs.changeSummary"]))),s.append($("<div />",{role:"tabpanel",class:"tab-pane",id:"workspace-changes"}).append($("<div />",{class:"form-section"}).append(Backend.generateDiffView(a.diff))))),a.comments.length>0&&(i.append($("<li />",{role:"presentation"}).append($("<a />",{href:"#workspace-comments","aria-controls":"workspace-comments",role:"tab","data-toggle":"tab"}).html(TYPO3.lang["window.recordChanges.tabs.comments"]+"&nbsp;").append($("<span />",{class:"badge"}).text(a.comments.length)))),s.append($("<div />",{role:"tabpanel",class:"tab-pane",id:"workspace-comments"}).append($("<div />",{class:"form-section"}).append(Backend.generateCommentView(a.comments))))),a.history.total>0&&(i.append($("<li />",{role:"presentation"}).append($("<a />",{href:"#workspace-history","aria-controls":"workspace-history",role:"tab","data-toggle":"tab"}).text(TYPO3.lang["window.recordChanges.tabs.history"]))),s.append($("<div />",{role:"tabpanel",class:"tab-pane",id:"workspace-history"}).append($("<div />",{class:"form-section"}).append(Backend.generateHistoryView(a.history.data))))),i.find("li").first().addClass("active"),s.find(".tab-pane").first().addClass("active"),n.append($("<div />").append(i,s)),t.data("stage")!==t.data("prevStage")&&o.push({text:a.label_PrevStage.title,active:!0,btnClass:"btn-default",name:"prevstage",trigger:function(){Modal.currentModal.trigger("modal-dismiss"),_this.sendToStage(t,"prev")}}),o.push({text:a.label_NextStage.title,active:!0,btnClass:"btn-default",name:"nextstage",trigger:function(){Modal.currentModal.trigger("modal-dismiss"),_this.sendToStage(t,"next")}}),o.push({text:TYPO3.lang.close,active:!0,btnClass:"btn-info",name:"cancel",trigger:function(){Modal.currentModal.trigger("modal-dismiss")}}),Modal.advanced({type:Modal.types.default,title:TYPO3.lang["window.recordInformation"].replace("{0}",$.trim(t.find(".t3js-title-live").text())),content:n,severity:Severity_1.SeverityEnum.info,buttons:o,size:Modal.sizes.medium})})},_this.openPreview=function(e){var $tr=$(e.currentTarget).closest("tr");_this.sendRemoteRequest(_this.generateRemoteActionsPayload("viewSingleRecord",[$tr.data("table"),$tr.data("uid")])).done(function(response){eval(response[0].result)})},_this.confirmDeleteRecordFromWorkspace=function(e){var t=$(e.target).closest("tr"),a=Modal.confirm(TYPO3.lang["window.discard.title"],TYPO3.lang["window.discard.message"],Severity_1.SeverityEnum.warning,[{text:TYPO3.lang.cancel,active:!0,btnClass:"btn-default",name:"cancel",trigger:function(){a.modal("hide")}},{text:TYPO3.lang.ok,btnClass:"btn-warning",name:"ok"}]);a.on("button.clicked",function(e){"ok"===e.target.name&&_this.sendRemoteRequest([_this.generateRemoteActionsPayload("deleteSingleRecord",[t.data("table"),t.data("uid")])]).done(function(){a.modal("hide"),_this.getWorkspaceInfos(),Backend.refreshPageTree()})})},_this.runSelectionAction=function(){var e=_this.elements.$chooseSelectionAction.val(),t="discard"!==e;if(0!==e.length){for(var a=[],n=0;n<_this.markedRecordsForMassAction.length;++n){var i=_this.markedRecordsForMassAction[n].split(":");a.push({table:i[0],liveId:i[2],versionId:i[1]})}t?_this.checkIntegrity({selection:a,type:"selection"}).done(function(t){Wizard.setup.forceSelection=!1,"warning"===t[0].result.result&&_this.addIntegrityCheckWarningToWizard(),_this.renderSelectionActionWizard(e,a)}):(Wizard.setup.forceSelection=!1,_this.renderSelectionActionWizard(e,a))}},_this.addIntegrityCheckWarningToWizard=function(){Wizard.addSlide("integrity-warning","Warning",TYPO3.lang["integrity.hasIssuesDescription"]+"<br>"+TYPO3.lang["integrity.hasIssuesQuestion"],Severity_1.SeverityEnum.warning)},_this.runMassAction=function(){var e=_this.elements.$chooseMassAction.val(),t="discard"!==e;0!==e.length&&(t?_this.checkIntegrity({language:_this.settings.language,type:e}).done(function(t){Wizard.setup.forceSelection=!1,"warning"===t[0].result.result&&_this.addIntegrityCheckWarningToWizard(),_this.renderMassActionWizard(e)}):(Wizard.setup.forceSelection=!1,_this.renderMassActionWizard(e)))},_this.sendToSpecificStageAction=function(e){for(var t=[],a=$(e.currentTarget).val(),n=0;n<_this.markedRecordsForMassAction.length;++n){var i=_this.markedRecordsForMassAction[n].split(":");t.push({table:i[0],uid:i[1],t3ver_oid:i[2]})}_this.sendRemoteRequest(_this.generateRemoteActionsPayload("sendToSpecificStageWindow",[a,t])).done(function(e){var n=_this.renderSendToStageWindow(e);n.on("button.clicked",function(e){if("ok"===e.target.name){var i=Utility.convertFormToObject(e.currentTarget.querySelector("form"));i.affects={elements:t,nextStage:a},_this.sendRemoteRequest([_this.generateRemoteActionsPayload("sendToSpecificStageExecute",[i]),_this.generateRemotePayload("getWorkspaceInfos",_this.settings)]).done(function(e){n.modal("hide"),_this.renderWorkspaceInfos(e[1].result),Backend.refreshPageTree()})}}).on("modal-destroyed",function(){_this.elements.$chooseStageAction.val("")})})},_this.generatePreviewLinks=function(){_this.sendRemoteRequest(_this.generateRemoteActionsPayload("generateWorkspacePreviewLinksForAllLanguages",[_this.settings.id])).done(function(e){var t=e[0].result,a=$("<dl />");$.each(t,function(e,t){a.append($("<dt />").text(e),$("<dd />").append($("<a />",{href:t,target:"_blank"}).text(t)))}),Modal.show(TYPO3.lang.previewLink,a,Severity_1.SeverityEnum.info,[{text:TYPO3.lang.ok,active:!0,btnClass:"btn-info",name:"ok",trigger:function(){Modal.currentModal.trigger("modal-dismiss")}}],["modal-inner-scroll"])})},$(function(){var e;_this.getElements(),_this.registerEvents(),Persistent.isset("this.Module.depth")?(e=Persistent.get("this.Module.depth"),_this.elements.$depthSelector.val(e),_this.settings.depth=e):_this.settings.depth=TYPO3.settings.Workspaces.depth,_this.loadWorkspaceComponents()}),_this}return __extends(Backend,_super),Backend.refreshPageTree=function(){Viewport.NavigationContainer&&Viewport.NavigationContainer.PageTree&&Viewport.NavigationContainer.PageTree.refreshTree()},Backend.generateDiffView=function(e){for(var t=$("<div />",{class:"diff"}),a=0;a<e.length;++a)t.append($("<div />",{class:"diff-item"}).append($("<div />",{class:"diff-item-title"}).text(e[a].label),$("<div />",{class:"diff-item-result diff-item-result-inline"}).html(e[a].content)));return t},Backend.generateCommentView=function(e){for(var t=$("<div />"),a=0;a<e.length;++a){var n=$("<div />",{class:"panel panel-default"});e[a].user_comment.length>0&&n.append($("<div />",{class:"panel-body"}).html(e[a].user_comment)),n.append($("<div />",{class:"panel-footer"}).append($("<span />",{class:"label label-success"}).text(e[a].stage_title),$("<span />",{class:"label label-info"}).text(e[a].tstamp))),t.append($("<div />",{class:"media"}).append($("<div />",{class:"media-left text-center"}).text(e[a].user_username).prepend($("<div />").html(e[a].user_avatar)),$("<div />",{class:"media-body"}).append(n)))}return t},Backend.generateHistoryView=function(e){for(var t=$("<div />"),a=0;a<e.length;++a){var n=$("<div />",{class:"panel panel-default"}),i=void 0;if("object"==typeof e[a].differences){if(0===e[a].differences.length)continue;i=$("<div />",{class:"diff"});for(var s=0;s<e[a].differences.length;++s)i.append($("<div />",{class:"diff-item"}).append($("<div />",{class:"diff-item-title"}).text(e[a].differences[s].label),$("<div />",{class:"diff-item-result diff-item-result-inline"}).html(e[a].differences[s].html)));n.append($("<div />").append(i))}else n.append($("<div />",{class:"panel-body"}).text(e[a].differences));n.append($("<div />",{class:"panel-footer"}).append($("<span />",{class:"label label-info"}).text(e[a].datetime))),t.append($("<div />",{class:"media"}).append($("<div />",{class:"media-left text-center"}).text(e[a].user).prepend($("<div />").html(e[a].user_avatar)),$("<div />",{class:"media-body"}).append(n)))}return t},Backend.prototype.getElements=function(){this.elements.$searchForm=$(Identifiers.searchForm),this.elements.$searchTextField=$(Identifiers.searchTextField),this.elements.$searchSubmitBtn=$(Identifiers.searchSubmitBtn),this.elements.$depthSelector=$(Identifiers.depthSelector),this.elements.$languageSelector=$(Identifiers.languageSelector),this.elements.$container=$(Identifiers.container),this.elements.$tableBody=this.elements.$container.find("tbody"),this.elements.$actionIcons=$(Identifiers.actionIcons),this.elements.$toggleAll=$(Identifiers.toggleAll),this.elements.$chooseStageAction=$(Identifiers.chooseStageAction),this.elements.$chooseSelectionAction=$(Identifiers.chooseSelectionAction),this.elements.$chooseMassAction=$(Identifiers.chooseMassAction),this.elements.$previewLinksButton=$(Identifiers.previewLinksButton),this.elements.$pagination=$(Identifiers.pagination)},Backend.prototype.registerEvents=function(){var e=this;$(document).on("click",'[data-action="swap"]',function(t){var a=t.target.closest("tr");e.checkIntegrity({selection:[{liveId:a.dataset.uid,versionId:a.dataset.t3ver_oid,table:a.dataset.table}],type:"selection"}).done(function(t){"warning"===t[0].result.result&&e.addIntegrityCheckWarningToWizard(),Wizard.set("forceSelection",!1),Wizard.addSlide("swap-confirm","Swap",TYPO3.lang["window.swap.message"],Severity_1.SeverityEnum.info),Wizard.addFinalProcessingSlide(function(){e.sendRemoteRequest(e.generateRemoteActionsPayload("swapSingleRecord",[a.dataset.table,a.dataset.t3ver_oid,a.dataset.uid])).done(function(){Wizard.dismiss(),e.getWorkspaceInfos(),Backend.refreshPageTree()})}).done(function(){Wizard.show()})})}).on("click",'[data-action="prevstage"]',function(t){e.sendToStage($(t.currentTarget).closest("tr"),"prev")}).on("click",'[data-action="nextstage"]',function(t){e.sendToStage($(t.currentTarget).closest("tr"),"next")}).on("click",'[data-action="changes"]',this.viewChanges).on("click",'[data-action="preview"]',this.openPreview).on("click",'[data-action="open"]',function(e){var t=e.currentTarget.closest("tr"),a=TYPO3.settings.FormEngine.moduleUrl+"&returnUrl="+encodeURIComponent(document.location.href)+"&id="+TYPO3.settings.Workspaces.id+"&edit["+t.dataset.table+"]["+t.dataset.uid+"]=edit";TYPO3.settings.Workspaces.allView&&(a+="&workspace="+t.dataset.t3ver_wsid),window.location.href=a}).on("click",'[data-action="version"]',function(e){var t=e.currentTarget.closest("tr"),a="pages"===t.dataset.table?t.dataset.t3ver_oid:t.dataset.pid;window.location.href=top.TYPO3.configuration.pageModuleUrl+"&id="+a+"&returnUrl="+encodeURIComponent(window.location.href)}).on("click",'[data-action="remove"]',this.confirmDeleteRecordFromWorkspace).on("click",'[data-action="expand"]',function(t){var a,n=$(t.currentTarget);a="true"===e.elements.$tableBody.find(n.data("target")).first().attr("aria-expanded")?"apps-pagetree-expand":"apps-pagetree-collapse",n.empty().append(e.getPreRenderedIcon(a))}),$(window.top.document).on("click",".t3js-workspace-recipients-selectall",function(e){e.preventDefault(),$(".t3js-workspace-recipient",window.top.document).not(":disabled").prop("checked",!0)}).on("click",".t3js-workspace-recipients-deselectall",function(e){e.preventDefault(),$(".t3js-workspace-recipient",window.top.document).not(":disabled").prop("checked",!1)}),this.elements.$searchForm.on("submit",function(t){t.preventDefault(),e.settings.filterTxt=e.elements.$searchTextField.val(),e.getWorkspaceInfos()}),this.elements.$searchTextField.on("keyup",function(t){""!==t.target.value?e.elements.$searchSubmitBtn.removeClass("disabled"):(e.elements.$searchSubmitBtn.addClass("disabled"),e.getWorkspaceInfos())}).clearable({onClear:function(){e.elements.$searchSubmitBtn.addClass("disabled"),e.settings.filterTxt="",e.getWorkspaceInfos()}}),this.elements.$toggleAll.on("click",function(){e.allToggled=!e.allToggled,e.elements.$tableBody.find('input[type="checkbox"]').prop("checked",e.allToggled).trigger("change")}),this.elements.$tableBody.on("change","tr input[type=checkbox]",this.handleCheckboxChange),this.elements.$depthSelector.on("change",function(t){var a=t.target.value;Persistent.set("this.Module.depth",a),e.settings.depth=a,e.getWorkspaceInfos()}),this.elements.$previewLinksButton.on("click",this.generatePreviewLinks),this.elements.$languageSelector.on("change",function(t){var a=$(t.target);e.settings.language=a.val(),e.sendRemoteRequest([e.generateRemoteActionsPayload("saveLanguageSelection",[a.val()]),e.generateRemotePayload("getWorkspaceInfos",e.settings)]).done(function(t){e.elements.$languageSelector.prev().html(a.find(":selected").data("icon")),e.renderWorkspaceInfos(t[1].result)})}),this.elements.$chooseStageAction.on("change",this.sendToSpecificStageAction),this.elements.$chooseSelectionAction.on("change",this.runSelectionAction),this.elements.$chooseMassAction.on("change",this.runMassAction),this.elements.$pagination.on("click","a[data-action]",function(t){t.preventDefault();var a=$(t.currentTarget),n=!1;switch(a.data("action")){case"previous":e.paging.currentPage>1&&(e.paging.currentPage--,n=!0);break;case"next":e.paging.currentPage<e.paging.totalPages&&(e.paging.currentPage++,n=!0);break;case"page":e.paging.currentPage=parseInt(a.data("page"),10),n=!0;break;default:throw'Unknown action "'+a.data("action")+'"'}n&&(e.settings.start=parseInt(e.settings.limit.toString(),10)*(e.paging.currentPage-1),e.getWorkspaceInfos())})},Backend.prototype.sendToStage=function(e,t){var a,n,i,s=this;if("next"===t)a=e.data("nextStage"),n="sendToNextStageWindow",i="sendToNextStageExecute";else{if("prev"!==t)throw"Invalid direction given.";a=e.data("prevStage"),n="sendToPrevStageWindow",i="sendToPrevStageExecute"}this.sendRemoteRequest(this.generateRemoteActionsPayload(n,[e.data("uid"),e.data("table"),e.data("t3ver_oid")])).done(function(t){var n=s.renderSendToStageWindow(t);n.on("button.clicked",function(t){if("ok"===t.target.name){var o=Utility.convertFormToObject(t.currentTarget.querySelector("form"));o.affects={table:e.data("table"),nextStage:a,t3ver_oid:e.data("t3ver_oid"),uid:e.data("uid"),elements:[]},s.sendRemoteRequest([s.generateRemoteActionsPayload(i,[o]),s.generateRemotePayload("getWorkspaceInfos",s.settings)]).done(function(e){n.modal("hide"),s.renderWorkspaceInfos(e[1].result),Backend.refreshPageTree()})}})})},Backend.prototype.loadWorkspaceComponents=function(){var e=this;this.sendRemoteRequest([this.generateRemotePayload("getWorkspaceInfos",this.settings),this.generateRemotePayload("getStageActions",{}),this.generateRemoteMassActionsPayload("getMassStageActions",{}),this.generateRemotePayload("getSystemLanguages",{pageUid:this.elements.$container.data("pageUid")})]).done(function(t){e.elements.$depthSelector.prop("disabled",!1),e.renderWorkspaceInfos(t[0].result);var a,n=t[1].result.data;for(a=0;a<n.length;++a)e.elements.$chooseStageAction.append($("<option />").val(n[a].uid).text(n[a].title));var i=t[2].result.data;for(a=0;a<i.length;++a)e.elements.$chooseSelectionAction.append($("<option />").val(i[a].action).text(i[a].title)),e.elements.$chooseMassAction.append($("<option />").val(i[a].action).text(i[a].title));var s=t[3].result.data;for(a=0;a<s.length;++a){var o=$("<option />").val(s[a].uid).text(s[a].title).data("icon",s[a].icon);String(s[a].uid)===String(TYPO3.settings.Workspaces.language)&&(o.prop("selected",!0),e.elements.$languageSelector.prev().html(s[a].icon)),e.elements.$languageSelector.append(o)}e.elements.$languageSelector.prop("disabled",!1)})},Backend.prototype.getWorkspaceInfos=function(){var e=this;this.sendRemoteRequest(this.generateRemotePayload("getWorkspaceInfos",this.settings)).done(function(t){e.renderWorkspaceInfos(t[0].result)})},Backend.prototype.renderWorkspaceInfos=function(e){this.elements.$tableBody.children().remove(),this.allToggled=!1,this.elements.$chooseStageAction.prop("disabled",!0),this.elements.$chooseSelectionAction.prop("disabled",!0),this.elements.$chooseMassAction.prop("disabled",0===e.data.length),this.buildPagination(e.total);for(var t=0;t<e.data.length;++t){var a=e.data[t],n=$("<div />",{class:"btn-group"}),i=void 0;n.append(this.getAction(a.Workspaces_CollectionChildren>0&&""!==a.Workspaces_CollectionCurrent,"expand","apps-pagetree-collapse").attr("title",TYPO3.lang["tooltip.expand"]).attr("data-target",'[data-collection="'+a.Workspaces_CollectionCurrent+'"]').attr("data-toggle","collapse"),$("<button />",{class:"btn btn-default","data-action":"changes","data-toggle":"tooltip",title:TYPO3.lang["tooltip.showChanges"]}).append(this.getPreRenderedIcon("actions-document-info")),this.getAction(a.allowedAction_swap&&""===a.Workspaces_CollectionParent,"swap","actions-version-swap-version").attr("title",TYPO3.lang["tooltip.swap"]),this.getAction(a.allowedAction_view,"preview","actions-version-workspace-preview").attr("title",TYPO3.lang["tooltip.viewElementAction"]),this.getAction(a.allowedAction_edit,"open","actions-open").attr("title",TYPO3.lang["tooltip.editElementAction"]),this.getAction(!0,"version","actions-version-page-open").attr("title",TYPO3.lang["tooltip.openPage"]),this.getAction(a.allowedAction_delete,"remove","actions-version-document-remove").attr("title",TYPO3.lang["tooltip.discardVersion"])),""!==a.integrity.messages&&(i=$(TYPO3.settings.Workspaces.icons[a.integrity.status])).attr("data-toggle","tooltip").attr("data-placement","top").attr("data-html","true").attr("title",a.integrity.messages),this.latestPath!==a.path_Workspace&&(this.latestPath=a.path_Workspace,this.elements.$tableBody.append($("<tr />").append($("<th />"),$("<th />",{colspan:6}).text(this.latestPath))));var s=$("<label />",{class:"btn btn-default btn-checkbox"}).append($("<input />",{type:"checkbox"}),$("<span />",{class:"t3-icon fa"})),o={"data-uid":a.uid,"data-pid":a.livepid,"data-t3ver_oid":a.t3ver_oid,"data-t3ver_wsid":a.t3ver_wsid,"data-table":a.table,"data-next-stage":a.value_nextStage,"data-prev-stage":a.value_prevStage,"data-stage":a.stage};""!==a.Workspaces_CollectionParent&&(o["data-collection"]=a.Workspaces_CollectionParent,o.class="collapse"),this.elements.$tableBody.append($("<tr />",o).append($("<td />").empty().append(s),$("<td />",{class:"t3js-title-workspace",style:a.Workspaces_CollectionLevel>0?"padding-left: "+this.indentationPadding*a.Workspaces_CollectionLevel+"px":""}).html(a.icon_Workspace+'&nbsp;<a href="#" data-action="changes"><span class="item-state-'+a.state_Workspace+'">'+a.label_Workspace+"</span></a>"),$("<td />",{class:"t3js-title-live"}).html(a.icon_Live+"&nbsp;"+a.label_Live),$("<td />").text(a.label_Stage),$("<td />").empty().append(i),$("<td />").html(a.language.icon),$("<td />",{class:"text-right nowrap"}).append(n))),Tooltip.initialize('[data-toggle="tooltip"]',{delay:{show:500,hide:100},trigger:"hover",container:"body"})}},Backend.prototype.buildPagination=function(e){if(0!==e)if(this.paging.totalItems=e,this.paging.totalPages=Math.ceil(e/parseInt(this.settings.limit.toString(),10)),1!==this.paging.totalPages){var t=$("<ul />",{class:"pagination pagination-block"}),a=[],n=$("<li />").append($("<a />",{"data-action":"previous"}).append($("<span />",{class:"t3-icon fa fa-arrow-left"}))),i=$("<li />").append($("<a />",{"data-action":"next"}).append($("<span />",{class:"t3-icon fa fa-arrow-right"})));1===this.paging.currentPage&&n.disablePagingAction(),this.paging.currentPage===this.paging.totalPages&&i.disablePagingAction();for(var s=1;s<=this.paging.totalPages;s++){var o=$("<li />",{class:this.paging.currentPage===s?"active":""});o.append($("<a />",{"data-action":"page","data-page":s}).append($("<span />").text(s))),a.push(o)}t.append(n,a,i),this.elements.$pagination.empty().append(t)}else this.elements.$pagination.contents().remove();else this.elements.$pagination.contents().remove()},Backend.prototype.renderSelectionActionWizard=function(e,t){var a=this;Wizard.addSlide("mass-action-confirmation",TYPO3.lang["window.selectionAction.title"],$("<p />").text(TYPO3.lang["tooltip."+e+"Selected"]),Severity_1.SeverityEnum.warning),Wizard.addFinalProcessingSlide(function(){a.sendRemoteRequest(a.generateRemoteActionsPayload("executeSelectionAction",{action:e,selection:t})).done(function(){a.getWorkspaceInfos(),Wizard.dismiss(),Backend.refreshPageTree()})}).done(function(){Wizard.show(),Wizard.getComponent().on("wizard-dismissed",function(){a.elements.$chooseSelectionAction.val("")})})},Backend.prototype.renderMassActionWizard=function(e){var t,a=this,n=!1;switch(e){case"publish":t="publishWorkspace";break;case"swap":t="publishWorkspace",n=!0;break;case"discard":t="flushWorkspace";break;default:throw"Invalid mass action "+e+" called."}Wizard.set("forceSelection",!1),Wizard.addSlide("mass-action-confirmation",TYPO3.lang["window.massAction.title"],$("<p />").html(TYPO3.lang["tooltip."+e+"All"]+"<br><br>"+TYPO3.lang["tooltip.affectWholeWorkspace"]),Severity_1.SeverityEnum.warning);var i=function(e){var n=e[0].result;n.processed<n.total?a.sendRemoteRequest(a.generateRemoteMassActionsPayload(t,n)).done(i):(a.getWorkspaceInfos(),Wizard.dismiss())};Wizard.addFinalProcessingSlide(function(){a.sendRemoteRequest(a.generateRemoteMassActionsPayload(t,{init:!0,total:0,processed:0,language:a.settings.language,swap:n})).done(i)}).done(function(){Wizard.show(),Wizard.getComponent().on("wizard-dismissed",function(){a.elements.$chooseMassAction.val("")})})},Backend.prototype.getAction=function(e,t,a){return e?$("<button />",{class:"btn btn-default","data-action":t,"data-toggle":"tooltip"}).append(this.getPreRenderedIcon(a)):$("<span />",{class:"btn btn-default disabled"}).append(this.getPreRenderedIcon("empty-empty"))},Backend.prototype.getPreRenderedIcon=function(e){return this.elements.$actionIcons.find('[data-identifier="'+e+'"]').clone()},Backend}(Workspaces_1.default);return new Backend});